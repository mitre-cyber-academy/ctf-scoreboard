# frozen_string_literal: true

class PentestSolvedChallenge < SolvedChallenge
  scope :group_by_defense_team, -> (team) { where(team: team).joins(challenge: :category).group('categories.name') }

  belongs_to :flag, foreign_key: 'flag_id', class_name: 'PentestFlag', optional: false, inverse_of: :solved_challenges
  belongs_to :division, foreign_key: 'division_id', class_name: 'PentestDivision', optional: false
  belongs_to :challenge, foreign_key: 'challenge_id', class_name: 'PentestChallenge', optional: false

  def self.solves_by_defense_team_for(team)
    # TODO, make this group by defensive team
  end

  def team_has_not_solved_challenge
    challenge_is_solved = team.solved_challenges.find_by(challenge: challenge, flag: flag)

    super if challenge_is_solved
  end
end
