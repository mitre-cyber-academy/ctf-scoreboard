# frozen_string_literal: true

FactoryBot.define do
  factory :pentest_challenge, parent: :challenge, class: 'PentestChallenge' do
    type { 'PentestChallenge' }

    pentest_game { create(:game) }
    design_phase { false }

    after(:build) do |challenge, evaluator|
      evaluator.flag_count.times do
        create(:pentest_flag, challenge: challenge) unless challenge.design_phase
      end
    end

    factory :pentest_challenge_with_flags do
      after(:create) do |challenge|
        Team.all.each do |team|
          create(:pentest_flag, team: team, challenge: challenge)
        end
      end
    end

    factory :pentest_challenge_with_achievement do
      achievement_name { 'achievement triggered by challenge completion' }
    end

    factory :design_phase_pentest_challenge_with_flag do
      design_phase { true }
      after(:create) do |challenge|
        create(:design_phase_pentest_flag, challenge: challenge)
      end
    end

    factory :design_phase_pentest_challenge do
      design_phase { true }
    end
  end
end
