# frozen_string_literal: true

FactoryBot.define do
  factory :pentest_challenge, parent: :challenge, class: 'PentestChallenge' do
    type { 'PentestChallenge' }

    pentest_game { create(:game) }

    after(:build) do |challenge, evaluator|
      evaluator.flag_count.times do
        create(:pentest_flag, challenge: challenge)
      end
    end

    factory :pentest_challenge_with_flags do
      after(:create) do |challenge|
        Team.all.each do |team|
          create(:pentest_flag, team: team, challenge: challenge)
        end
      end
    end

    factory :pentest_challenge_with_achievement do
      achievement_name { 'achievement triggered by challenge completion' }
    end
  end
end
