require 'test_helper'

class DefenseFlagTest < ActiveSupport::TestCase
  def setup
    @game = create(:active_game)
    @defense_team = create(:team)
    @challenge = create(
                  :pentest_challenge,
                  point_value: 100,
                  first_capture_point_bonus: 0,
                  initial_shares: 1,
                  unsolved_increment_period: 1, # Hours
                  unsolved_increment_points: 0,
                  solved_decrement_period: 1, # Hours
                  solved_decrement_shares: 0,
                  defense_period: 1, # Hours
                  defense_points: 0,
                  flag_count: 0
                )
    @flag = create(:defense_flag, challenge: @challenge, team: @defense_team)
  end

  test 'point value' do
    solve_team = create(:team)
    unsolve_team = create(:team)
    solved_challenge = create(:pentest_solved_challenge, team: solve_team, challenge: @challenge)
    point_value = solved_challenge.flag.point_value(unsolve_team)
    assert_equal 50, point_value
  end

  test 'challenge open?' do
    assert @flag.challenge_open?

    @challenge.update(state: 0)

    assert_not @flag.challenge_open?
  end
end
